{"ast":null,"code":"var _jsxFileName = \"/home/ues/Documentos/GitHub/testefrontamai/src/Login.js\";\nimport React, { Component } from 'react';\nimport swal from 'sweetalert';\nimport { Button, TextField, Link, CircularProgress } from '@material-ui/core';\nimport axios from 'axios';\nimport \"./Login.css\";\nexport default class Login extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onChange = e => this.setState({\n      [e.target.name]: e.target.value\n    });\n\n    this.wakeServer = async () => {\n      try {\n        await axios.get(\"https://backtestmar.onrender.com/health\", {\n          timeout: 5000\n        });\n      } catch (e) {// ignora erro â€” a ideia Ã© sÃ³ \"acordar\"\n      }\n    };\n\n    this.login = async () => {\n      const {\n        username,\n        password,\n        loading\n      } = this.state;\n      if (loading) return;\n\n      if (!username || !password) {\n        swal({\n          text: 'Preencha usuÃ¡rio e senha',\n          icon: 'error'\n        });\n        return;\n      }\n\n      this.setState({\n        loading: true\n      });\n\n      try {\n        var _response, _response$data, _response2, _response2$data, _response3, _response3$data;\n\n        // ðŸ‘‰ Primeiro passo: acorda o servidor\n        await this.wakeServer(); // ðŸ‘‰ Define um timeout curto (evita travar por 20s)\n\n        const api = axios.create({\n          baseURL: \"https://backtestmar.onrender.com\",\n          timeout: 6000\n        }); // ðŸ‘‰ Tenta fazer login (2 tentativas)\n\n        let response;\n\n        try {\n          response = await api.post(\"/login\", {\n            username,\n            password\n          });\n        } catch {\n          response = await api.post(\"/login\", {\n            username,\n            password\n          });\n        }\n\n        const token = (_response = response) === null || _response === void 0 ? void 0 : (_response$data = _response.data) === null || _response$data === void 0 ? void 0 : _response$data.token;\n        const id = ((_response2 = response) === null || _response2 === void 0 ? void 0 : (_response2$data = _response2.data) === null || _response2$data === void 0 ? void 0 : _response2$data.id) || ((_response3 = response) === null || _response3 === void 0 ? void 0 : (_response3$data = _response3.data) === null || _response3$data === void 0 ? void 0 : _response3$data._id);\n\n        if (!token) {\n          swal({\n            text: 'O servidor respondeu sem token.',\n            icon: 'error'\n          });\n          this.setState({\n            loading: false\n          });\n          return;\n        } // ðŸ‘‰ Salva token + ID corretamente\n\n\n        localStorage.setItem(\"token\", token);\n        if (id) localStorage.setItem(\"user_id\", id);\n        swal({\n          text: \"Login realizado com sucesso!\",\n          icon: \"success\"\n        });\n        this.props.history.push(\"/dashboard\");\n      } catch (err) {\n        if ((err === null || err === void 0 ? void 0 : err.code) === \"ECONNABORTED\") {\n          swal({\n            text: \"Servidor demorou para responder (timeout). Tente novamente.\",\n            icon: \"error\"\n          });\n        } else {\n          var _err$response, _err$response$data;\n\n          swal({\n            text: (err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.errorMessage) || \"Erro ao logar\",\n            icon: \"error\"\n          });\n        }\n      } finally {\n        this.setState({\n          loading: false\n        });\n      }\n    };\n\n    this.state = {\n      username: '',\n      password: '',\n      loading: false\n    };\n  }\n\n  render() {\n    const {\n      username,\n      password,\n      loading\n    } = this.state;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"login-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"login-card\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }\n    }, \"Login\"), /*#__PURE__*/React.createElement(TextField, {\n      fullWidth: true,\n      type: \"text\",\n      autoComplete: \"off\",\n      name: \"username\",\n      value: username,\n      onChange: this.onChange,\n      placeholder: \"Usu\\xE1rio\",\n      margin: \"dense\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(TextField, {\n      fullWidth: true,\n      type: \"password\",\n      autoComplete: \"off\",\n      name: \"password\",\n      value: password,\n      onChange: this.onChange,\n      placeholder: \"Senha\",\n      margin: \"dense\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"login-actions\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      onClick: this.login,\n      disabled: !username || !password || loading,\n      className: \"login-btn\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 13\n      }\n    }, loading ? \"Entrando...\" : \"Login\"), loading && /*#__PURE__*/React.createElement(CircularProgress, {\n      size: 26,\n      className: \"login-loading\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(Link, {\n      href: \"/register\",\n      className: \"login-register-link\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 13\n      }\n    }, \"Registro\"))));\n  }\n\n}","map":{"version":3,"sources":["/home/ues/Documentos/GitHub/testefrontamai/src/Login.js"],"names":["React","Component","swal","Button","TextField","Link","CircularProgress","axios","Login","constructor","props","onChange","e","setState","target","name","value","wakeServer","get","timeout","login","username","password","loading","state","text","icon","api","create","baseURL","response","post","token","data","id","_id","localStorage","setItem","history","push","err","code","errorMessage","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport swal from 'sweetalert';\nimport { Button, TextField, Link, CircularProgress } from '@material-ui/core';\nimport axios from 'axios';\nimport \"./Login.css\";\n\nexport default class Login extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      username: '',\n      password: '',\n      loading: false\n    };\n  }\n\n  onChange = (e) => this.setState({ [e.target.name]: e.target.value });\n\n  // ----------------------------------------\n  // FUNÃ‡ÃƒO PARA ACORDAR O RENDER (PING)\n  // ----------------------------------------\n  wakeServer = async () => {\n    try {\n      await axios.get(\"https://backtestmar.onrender.com/health\", { timeout: 5000 });\n    } catch (e) {\n      // ignora erro â€” a ideia Ã© sÃ³ \"acordar\"\n    }\n  };\n\n  // ----------------------------------------\n  // LOGIN OTIMIZADO\n  // ----------------------------------------\n  login = async () => {\n    const { username, password, loading } = this.state;\n\n    if (loading) return;\n\n    if (!username || !password) {\n      swal({ text: 'Preencha usuÃ¡rio e senha', icon: 'error' });\n      return;\n    }\n\n    this.setState({ loading: true });\n\n    try {\n      // ðŸ‘‰ Primeiro passo: acorda o servidor\n      await this.wakeServer();\n\n      // ðŸ‘‰ Define um timeout curto (evita travar por 20s)\n      const api = axios.create({\n        baseURL: \"https://backtestmar.onrender.com\",\n        timeout: 6000\n      });\n\n      // ðŸ‘‰ Tenta fazer login (2 tentativas)\n      let response;\n      try {\n        response = await api.post(\"/login\", { username, password });\n      } catch {\n        response = await api.post(\"/login\", { username, password });\n      }\n\n      const token = response?.data?.token;\n      const id = response?.data?.id || response?.data?._id;\n\n      if (!token) {\n        swal({ text: 'O servidor respondeu sem token.', icon: 'error' });\n        this.setState({ loading: false });\n        return;\n      }\n\n      // ðŸ‘‰ Salva token + ID corretamente\n      localStorage.setItem(\"token\", token);\n      if (id) localStorage.setItem(\"user_id\", id);\n\n      swal({ text: \"Login realizado com sucesso!\", icon: \"success\" });\n\n      this.props.history.push(\"/dashboard\");\n\n    } catch (err) {\n\n      if (err?.code === \"ECONNABORTED\") {\n        swal({\n          text: \"Servidor demorou para responder (timeout). Tente novamente.\",\n          icon: \"error\"\n        });\n      } else {\n        swal({\n          text: err?.response?.data?.errorMessage || \"Erro ao logar\",\n          icon: \"error\"\n        });\n      }\n\n    } finally {\n      this.setState({ loading: false });\n    }\n  };\n\n  render() {\n    const { username, password, loading } = this.state;\n\n    return (\n      <div className=\"login-container\">\n        <div className=\"login-card\">\n          <h2>Login</h2>\n\n          <TextField\n            fullWidth\n            type=\"text\"\n            autoComplete=\"off\"\n            name=\"username\"\n            value={username}\n            onChange={this.onChange}\n            placeholder=\"UsuÃ¡rio\"\n            margin=\"dense\"\n          />\n\n          <TextField\n            fullWidth\n            type=\"password\"\n            autoComplete=\"off\"\n            name=\"password\"\n            value={password}\n            onChange={this.onChange}\n            placeholder=\"Senha\"\n            margin=\"dense\"\n          />\n\n          <div className=\"login-actions\">\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              onClick={this.login}\n              disabled={!username || !password || loading}\n              className=\"login-btn\"\n            >\n              {loading ? \"Entrando...\" : \"Login\"}\n            </Button>\n\n            {loading && <CircularProgress size={26} className=\"login-loading\" />}\n\n            <Link href=\"/register\" className=\"login-register-link\">\n              Registro\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}