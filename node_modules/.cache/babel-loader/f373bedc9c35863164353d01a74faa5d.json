{"ast":null,"code":"import _defineProperty from\"/home/ues/Documentos/GitHub/testefrontamai/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/ues/Documentos/GitHub/testefrontamai/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/ues/Documentos/GitHub/testefrontamai/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/ues/Documentos/GitHub/testefrontamai/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/ues/Documentos/GitHub/testefrontamai/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/ues/Documentos/GitHub/testefrontamai/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{Button,TextField,Dialog,DialogActions,DialogTitle,DialogContent,TableBody,Table,TableContainer,TableHead,TableRow,TableCell,CircularProgress}from'@material-ui/core';import{Pagination}from'@material-ui/lab';import swal from'sweetalert';import axios from'axios';var Dashboard=/*#__PURE__*/function(_Component){_inherits(Dashboard,_Component);var _super=_createSuper(Dashboard);function Dashboard(){var _this;_classCallCheck(this,Dashboard);_this=_super.call(this);_this.componentDidMount=function(){var token=localStorage.getItem('token');if(!token){_this.props.history.push('/login');}else{_this.setState({token:token},function(){return _this.getCasal();});}};_this.getAuthHeaders=function(){var t=_this.state.token;if(!t)return{};return{Authorization:\"Bearer \".concat(t),token:t// fallback se o backend esperar header 'token'\n};};_this.getCasal=function(){_this.setState({loading:true});var data=\"?page=\".concat(_this.state.page);if(_this.state.search)data+=\"&search=\".concat(encodeURIComponent(_this.state.search));axios.get(\"https://backtestmar.onrender.com/get-casal\".concat(data),{headers:_this.getAuthHeaders()}).then(function(res){_this.setState({loading:false,casais:res.data.casais||[],pages:res.data.pages||0});}).catch(function(err){var _err$response,_err$response$data;var msg=(err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.errorMessage)||err.message;swal({text:msg,icon:\"error\",type:\"error\"});_this.setState({loading:false,casais:[],pages:0});});};_this.deleteCasal=function(id){if(!window.confirm('Tem certeza que deseja excluir este casal?'))return;axios.post('https://backtestmar.onrender.com/delete-casal',{id:id},{headers:_objectSpread({'Content-Type':'application/json'},_this.getAuthHeaders())}).then(function(res){swal({text:res.data.title,icon:\"success\",type:\"success\"});_this.setState({page:1},function(){return _this.pageChange(null,1);});}).catch(function(err){var _err$response2,_err$response2$data;var msg=(err===null||err===void 0?void 0:(_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.errorMessage)||err.message;swal({text:msg,icon:\"error\",type:\"error\"});});};_this.pageChange=function(e,page){_this.setState({page:page},function(){return _this.getCasal();});};_this.logOut=function(){localStorage.removeItem('token');_this.props.history.push('/');};_this.onChange=function(e){// se veio arquivo (input type=file), atualiza apenas fileName no state (não controlar value)\nif(e.target.files&&e.target.files[0]){_this.setState({fileName:e.target.files[0].name});return;}var _e$target=e.target,name=_e$target.name,value=_e$target.value;_this.setState(_defineProperty({},name,value),function(){if(name==='search'){_this.setState({page:1},function(){return _this.getCasal();});}});};_this.addCasal=function(){var fileInput=_this.fileInputAddRef.current;if(!fileInput||!fileInput.files[0]){swal({text:'Selecione uma imagem',icon:'error',type:'error'});return;}if(!_this.state.name||!_this.state.desc||!_this.state.tel||!_this.state.niverH||!_this.state.niverM){swal({text:'Preencha todos os campos',icon:'error',type:'error'});return;}var fd=new FormData();fd.append('file',fileInput.files[0]);fd.append('name',_this.state.name);fd.append('desc',_this.state.desc);fd.append('tel',_this.state.tel);fd.append('niverH',_this.state.niverH);fd.append('niverM',_this.state.niverM);axios.post('https://backtestmar.onrender.com/add-casal',fd,{headers:_objectSpread({'content-type':'multipart/form-data'},_this.getAuthHeaders())}).then(function(res){swal({text:res.data.title,icon:\"success\",type:\"success\"});_this.handleCasalClose();// limpar campos e recarregar\n_this.setState({name:'',desc:'',tel:'',niverH:'',niverM:'',fileName:'',page:1},function(){return _this.getCasal();});if(fileInput)fileInput.value=null;}).catch(function(err){var _err$response3,_err$response3$data;var msg=(err===null||err===void 0?void 0:(_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.errorMessage)||err.message;swal({text:msg,icon:\"error\",type:\"error\"});_this.handleCasalClose();});};_this.updateCasal=function(){var fileInput=_this.fileInputEditRef.current;var fd=new FormData();fd.append('id',_this.state.id);if(fileInput&&fileInput.files[0])fd.append('file',fileInput.files[0]);fd.append('name',_this.state.name);fd.append('desc',_this.state.desc);fd.append('tel',_this.state.tel);fd.append('niverH',_this.state.niverH);fd.append('niverM',_this.state.niverM);axios.post('https://backtestmar.onrender.com/update-casal',fd,{headers:_objectSpread({'content-type':'multipart/form-data'},_this.getAuthHeaders())}).then(function(res){swal({text:res.data.title,icon:\"success\",type:\"success\"});_this.handleCasaltEditClose();_this.setState({name:'',desc:'',tel:'',niverH:'',niverM:'',fileName:''},function(){return _this.getCasal();});if(fileInput)fileInput.value=null;}).catch(function(err){var _err$response4,_err$response4$data;var msg=(err===null||err===void 0?void 0:(_err$response4=err.response)===null||_err$response4===void 0?void 0:(_err$response4$data=_err$response4.data)===null||_err$response4$data===void 0?void 0:_err$response4$data.errorMessage)||err.message;swal({text:msg,icon:\"error\",type:\"error\"});_this.handleCasaltEditClose();});};_this.handleCasalOpen=function(){_this.setState({openCasalModal:true,id:'',name:'',desc:'',tel:'',niverH:'',niverM:'',fileName:''});// limpar input file add se existir\nif(_this.fileInputAddRef.current)_this.fileInputAddRef.current.value=null;};_this.handleCasalClose=function(){_this.setState({openCasalModal:false});};_this.handleCasalEditOpen=function(data){_this.setState({openCasalEditModal:true,id:data._id,name:data.name,desc:data.desc,tel:data.tel,niverH:data.niverH?data.niverH.substring(0,10):'',niverM:data.niverM?data.niverM.substring(0,10):'',fileName:data.image||''});if(_this.fileInputEditRef.current)_this.fileInputEditRef.current.value=null;};_this.handleCasaltEditClose=function(){_this.setState({openCasalEditModal:false});};_this.state={token:false,openCasalModal:false,openCasalEditModal:false,id:'',name:'',desc:'',tel:'',niverH:'',niverM:'',fileName:'',page:1,search:'',casais:[],pages:0,loading:false};// refs para inputs de arquivo (separados para adicionar / editar)\n_this.fileInputAddRef=React.createRef();_this.fileInputEditRef=React.createRef();return _this;}_createClass(Dashboard,[{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/React.createElement(\"div\",null,this.state.loading&&/*#__PURE__*/React.createElement(CircularProgress,{color:\"inherit\"}),/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},/*#__PURE__*/React.createElement(\"h2\",null,\"CELULAS DE CASAIS\"),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{variant:\"contained\",color:\"primary\",size:\"small\",onClick:this.handleCasalOpen,style:{marginRight:8}},\"Adicionar Casais\"),/*#__PURE__*/React.createElement(Button,{variant:\"contained\",size:\"small\",onClick:this.logOut},\"Sair\"))),/*#__PURE__*/React.createElement(Dialog,{open:this.state.openCasalEditModal,onClose:this.handleCasaltEditClose,\"aria-labelledby\":\"alert-dialog-title\",\"aria-describedby\":\"alert-dialog-description\"},/*#__PURE__*/React.createElement(DialogTitle,{id:\"alert-dialog-title\"},\"Editar Casais\"),/*#__PURE__*/React.createElement(DialogContent,null,/*#__PURE__*/React.createElement(TextField,{type:\"text\",autoComplete:\"off\",name:\"name\",value:this.state.name,onChange:this.onChange,placeholder:\"Nome Casal\",fullWidth:true,margin:\"dense\"}),/*#__PURE__*/React.createElement(TextField,{type:\"text\",autoComplete:\"off\",name:\"desc\",value:this.state.desc,onChange:this.onChange,placeholder:\"Descri\\xE7\\xE3o\",fullWidth:true,margin:\"dense\"}),/*#__PURE__*/React.createElement(TextField,{type:\"text\",autoComplete:\"off\",name:\"tel\",value:this.state.tel,onChange:this.onChange,placeholder:\"Contato\",fullWidth:true,margin:\"dense\"}),/*#__PURE__*/React.createElement(TextField,{type:\"date\",autoComplete:\"off\",name:\"niverH\",value:this.state.niverH,onChange:this.onChange,placeholder:\"Aniversario Homem\",fullWidth:true,margin:\"dense\",InputLabelProps:{shrink:true}}),/*#__PURE__*/React.createElement(TextField,{type:\"date\",autoComplete:\"off\",name:\"niverM\",value:this.state.niverM,onChange:this.onChange,placeholder:\"Aniversario Mulher\",fullWidth:true,margin:\"dense\",InputLabelProps:{shrink:true}}),/*#__PURE__*/React.createElement(\"div\",{style:{marginTop:12}},/*#__PURE__*/React.createElement(\"input\",{ref:this.fileInputEditRef,type:\"file\",accept:\"image/*\",name:\"file\",onChange:function onChange(e){return _this2.onChange(e);},id:\"fileInputEdit\",style:{display:'inline-block'}}),/*#__PURE__*/React.createElement(\"span\",{style:{marginLeft:8}},this.state.fileName))),/*#__PURE__*/React.createElement(DialogActions,null,/*#__PURE__*/React.createElement(Button,{onClick:this.handleCasaltEditClose,color:\"primary\"},\"Cancelar\"),/*#__PURE__*/React.createElement(Button,{disabled:this.state.name===''||this.state.desc===''||this.state.tel===''||this.state.niverH===''||this.state.niverM==='',onClick:function onClick(){return _this2.updateCasal();},color:\"primary\",autoFocus:true},\"Editar Casais\"))),/*#__PURE__*/React.createElement(Dialog,{open:this.state.openCasalModal,onClose:this.handleCasalClose,\"aria-labelledby\":\"alert-dialog-title\",\"aria-describedby\":\"alert-dialog-description\"},/*#__PURE__*/React.createElement(DialogTitle,{id:\"alert-dialog-title\"},\"Adicionar Casais\"),/*#__PURE__*/React.createElement(DialogContent,null,/*#__PURE__*/React.createElement(TextField,{type:\"text\",autoComplete:\"off\",name:\"name\",value:this.state.name,onChange:this.onChange,placeholder:\"Nome Casais\",fullWidth:true,margin:\"dense\"}),/*#__PURE__*/React.createElement(TextField,{type:\"text\",autoComplete:\"off\",name:\"desc\",value:this.state.desc,onChange:this.onChange,placeholder:\"Descri\\xE7\\xE3o\",fullWidth:true,margin:\"dense\"}),/*#__PURE__*/React.createElement(TextField,{type:\"text\",autoComplete:\"off\",name:\"tel\",value:this.state.tel,onChange:this.onChange,placeholder:\"Contato\",fullWidth:true,margin:\"dense\"}),/*#__PURE__*/React.createElement(TextField,{type:\"date\",autoComplete:\"off\",name:\"niverH\",value:this.state.niverH,onChange:this.onChange,placeholder:\"Aniversario Homem\",fullWidth:true,margin:\"dense\",InputLabelProps:{shrink:true}}),/*#__PURE__*/React.createElement(TextField,{type:\"date\",autoComplete:\"off\",name:\"niverM\",value:this.state.niverM,onChange:this.onChange,placeholder:\"Aniversario Mulher\",fullWidth:true,margin:\"dense\",InputLabelProps:{shrink:true}}),/*#__PURE__*/React.createElement(\"div\",{style:{marginTop:12}},/*#__PURE__*/React.createElement(\"input\",{ref:this.fileInputAddRef,type:\"file\",accept:\"image/*\",name:\"file\",onChange:function onChange(e){return _this2.onChange(e);},id:\"fileInputAdd\",style:{display:'inline-block'},required:true}),/*#__PURE__*/React.createElement(\"span\",{style:{marginLeft:8}},this.state.fileName))),/*#__PURE__*/React.createElement(DialogActions,null,/*#__PURE__*/React.createElement(Button,{onClick:this.handleCasalClose,color:\"primary\"},\"Cancelar\"),/*#__PURE__*/React.createElement(Button,{disabled:this.state.name===''||this.state.desc===''||this.state.tel===''||this.state.niverH===''||this.state.niverM===''||!this.fileInputAddRef.current||!this.fileInputAddRef.current.files[0],onClick:function onClick(){return _this2.addCasal();},color:\"primary\",autoFocus:true},\"Adicionar Casais\"))),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(TableContainer,null,/*#__PURE__*/React.createElement(\"div\",{style:{marginBottom:12}},/*#__PURE__*/React.createElement(TextField,{type:\"search\",autoComplete:\"off\",name:\"search\",value:this.state.search,onChange:this.onChange,placeholder:\"Procurar Casais\",variant:\"outlined\",size:\"small\"})),/*#__PURE__*/React.createElement(Table,{\"aria-label\":\"simple table\"},/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"Imagem\"),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"Nome Casal\"),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"Descri\\xE7\\xE3o\"),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"Contato\"),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"Aniversario Homem\"),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"Aniversario Mulher\"),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},\"A\\xE7\\xE3o\"))),/*#__PURE__*/React.createElement(TableBody,null,this.state.casais.map(function(row){return/*#__PURE__*/React.createElement(TableRow,{key:row._id||row.name},/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},row.image?/*#__PURE__*/React.createElement(\"img\",{src:\"https://backtestmar.onrender.com/\".concat(row.image),alt:\"\",width:\"70\",height:\"70\"}):'—'),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},row.name),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},row.desc),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},row.tel),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},row.niverH?row.niverH.substring(0,10):''),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},row.niverM?row.niverM.substring(0,10):''),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},/*#__PURE__*/React.createElement(Button,{variant:\"outlined\",color:\"primary\",size:\"small\",onClick:function onClick(){return _this2.handleCasalEditOpen(row);},style:{marginRight:6}},\"Editar\"),/*#__PURE__*/React.createElement(Button,{variant:\"outlined\",color:\"secondary\",size:\"small\",onClick:function onClick(){return _this2.deleteCasal(row._id);}},\"Deletar\")));}))),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(Pagination,{count:this.state.pages,page:this.state.page,onChange:this.pageChange,color:\"primary\"})));}}]);return Dashboard;}(Component);export{Dashboard as default};","map":null,"metadata":{},"sourceType":"module"}